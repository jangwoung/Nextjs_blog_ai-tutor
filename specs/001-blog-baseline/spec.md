# Feature Specification: ブログ ベースライン

**Feature Branch**: `001-blog-baseline`  
**Created**: 2026-02-04  
**Status**: Draft  
**Input**: User description: "Create baseline specification"

## User Scenarios & Testing *(mandatory)*

### User Story 1 - 公開サイトで記事を読む (Priority: P1)

訪問者は、トップページで公開済み記事の一覧（タイトル・サムネイル・日付・抜粋）を見て、気になった記事をクリックすると、記事詳細ページでトップに1枚の画像と本文を読める。

**Why this priority**: ブログの主目的は「記事を読めること」。これがなければ価値がない。

**Independent Test**: 一覧ページを開き、記事を1件クリックして詳細が表示され、画像と本文が読めることを確認すれば、このストーリー単体で価値が検証できる。

**Acceptance Scenarios**:

1. **Given** 公開済み記事が1件以上ある, **When** トップページを開く, **Then** 記事一覧が表示され、各記事にタイトル・サムネイル・日付・抜粋が含まれる
2. **Given** 一覧が表示されている, **When** ある記事をクリックする, **Then** その記事の詳細ページに遷移し、トップに1枚の画像と本文が表示される
3. **Given** 下書きの記事のみ存在する, **When** トップページを開く, **Then** 一覧には何も表示されない（または空の状態が適切に表示される）

---

### User Story 2 - 管理者がログインして管理画面を使う (Priority: P2)

管理者は、管理用のURLにアクセスし、正しいパスワードを入力するとログインでき、記事一覧・新規投稿・編集・削除ができる画面にアクセスできる。未ログインの場合はログイン画面に誘導される。

**Why this priority**: 記事を書く・管理するには、まず管理画面へのアクセス制御が必要。

**Independent Test**: 管理用URLにアクセスし、パスワードでログインし、記事一覧または新規投稿画面が表示されることを確認すれば、このストーリーが成立していると判断できる。

**Acceptance Scenarios**:

1. **Given** 未ログイン, **When** 管理用URLにアクセスする, **Then** ログイン画面が表示される
2. **Given** ログイン画面, **When** 正しいパスワードを入力して送信する, **Then** ログインされ、管理画面のトップ（記事一覧またはダッシュボード）に遷移する
3. **Given** ログイン済み, **When** ページを再読み込みする, **Then** ログイン状態が維持され、管理画面のままである
4. **Given** 未ログイン, **When** 管理用の内部URLを直リンクで開く, **Then** ログイン画面にリダイレクトされる

---

### User Story 3 - 管理者が記事を投稿・編集・削除する (Priority: P3)

管理者は、ログイン後に新規記事を作成できる（タイトル・本文・トップ用画像を指定可能）。既存記事は一覧から選んで編集または削除できる。記事は下書きとして保存でき、公開すると公開サイトの一覧に表示される。

**Why this priority**: 読む機能の次に、コンテンツを用意する機能が必須。

**Independent Test**: ログイン後、新規投稿で記事を1件作成し、一覧に表示されること、および公開後に公開サイトでその記事が読めることを確認すれば、このストーリーの価値が検証できる。

**Acceptance Scenarios**:

1. **Given** ログイン済み, **When** 新規投稿を選び、タイトル・本文・トップ画像を入力して保存する, **Then** 記事が保存され、管理用の記事一覧に表示される
2. **Given** 記事が下書きで保存されている, **When** 公開サイトのトップを開く, **Then** その記事は一覧に表示されない
3. **Given** 記事が公開済み, **When** 公開サイトのトップを開く, **Then** その記事が一覧に表示される
4. **Given** 管理用記事一覧, **When** ある記事の編集を選ぶ, **Then** 編集画面が開き、内容を変更して保存できる
5. **Given** 管理用記事一覧, **When** ある記事の削除を実行する, **Then** その記事は削除され、公開サイトからも消える
6. **Given** 管理用記事一覧, **When** 一覧を表示する, **Then** 下書き・公開を問わず全件が表示される

---

### Edge Cases

- 記事が0件のとき、公開サイトの一覧は空であることを適切に表示する。
- 存在しない slug で詳細ページにアクセスしたとき、404 または「記事が見つかりません」を表示する。
- 管理者がログインに失敗したとき、エラーメッセージを表示し、再入力を促す。
- 画像アップロードで不正な形式やサイズが送られたとき、拒否または制限し、ユーザーに分かる形で伝える。
- 記事の本文を表示する際、危険なスクリプト等が実行されないよう、表示用のサニタイズが行われる（XSS 対策）。

## Requirements *(mandatory)*

### Functional Requirements

- **FR-001**: システムは公開済みの記事のみを一覧・詳細で表示し、下書きは公開サイトに表示してはならない。
- **FR-002**: システムは記事一覧で、各記事のタイトル・サムネイル画像・公開日・抜粋を表示しなければならない。
- **FR-003**: システムは記事詳細で、トップに1枚の画像と本文を表示しなければならない。
- **FR-004**: システムは管理用の入口を保護し、認証されていない訪問者は管理機能にアクセスできてはならない。
- **FR-005**: 管理者は、認証後に記事の新規作成・編集・削除ができなければならない。
- **FR-006**: 管理者は、記事を下書きとして保存し、後から公開状態に変更できなければならない。
- **FR-007**: 管理用の記事一覧では、下書き・公開を問わず全件を表示しなければならない。
- **FR-008**: システムは記事本文の表示時に、XSS 等の攻撃を防ぐため、危険なコンテンツを無害化して表示しなければならない。
- **FR-009**: システムは、記事にトップ用の画像を1枚紐付けられるようにしなければならない。
- **FR-010**: 管理者は、画像をアップロードして記事に紐付けられるようにしなければならない。

### Key Entities

- **Post（記事）**: タイトル、本文（Markdown 等のテキスト）、トップ画像の URL、公開日、公開状態（下書き／公開）、一意の slug、作成日時・更新日時。公開サイトでは「公開」状態のもののみ取得する。管理画面では全件取得する。
- **Session / 認証状態**: 管理者がログイン済みかどうかを表す。仕様上は「ログイン済みであれば管理機能にアクセス可能」とし、実装方式（Cookie 等）は計画段階で決定する。

## Success Criteria *(mandatory)*

### Measurable Outcomes

- **SC-001**: 訪問者は、トップページから記事詳細まで、3クリック以内で任意の公開記事を読める。
- **SC-002**: 管理者は、ログインから新規記事の保存まで、5分以内に完了できる（通常の長さの記事・画像1枚を想定）。
- **SC-003**: 公開サイトでは、下書きの記事が一覧・詳細のいずれにも表示されないことが、手動確認で検証できる。
- **SC-004**: 管理画面では、全記事（下書き・公開）が一覧で確認でき、編集・削除・公開状態の変更が手動で検証できる。
- **SC-005**: 存在しない記事へのアクセス時、適切なエラー表示がされ、システムが異常終了しない。

## Assumptions

- 管理者は1種類のみ想定し、権限の細分化（複数ロール）は本ベースラインの範囲外とする。
- 認証は「パスワードによるログイン + セッション維持」とし、多要素認証やソーシャルログインは対象外とする。
- 記事の本文形式は Markdown を想定し、表示時に安全にレンダリングする。生の HTML をそのまま通すことは想定しない。
- 画像は記事あたりトップ用1枚を必須とし、本文中の複数画像は本ベースラインでは必須としない。
- コメント・いいね・検索・タグ等は本ベースラインの範囲外とする。
